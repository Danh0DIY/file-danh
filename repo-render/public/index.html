<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Danh sÃ¡ch file</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin-bottom: 10px;
    }
    button {
      margin-left: 10px;
      cursor: pointer;
    }
    #status {
      margin-top: 15px;
      color: #555;
    }
  </style>
</head>
<body>

  <h2>ğŸ“‚ Danh sÃ¡ch file</h2>
  <a href="/login.html">ğŸ” Admin Login</a>
  <hr>

  <ul id="list"></ul>
  <p id="status"></p>

  <script>
    const listEl = document.getElementById("list");
    const statusEl = document.getElementById("status");

    // ğŸ”½ Ã‰P Táº¢I FILE (KHÃ”NG Má» TAB)
    async function downloadFile(url, filename) {
      try {
        statusEl.innerText = "â³ Äang táº£i file...";

        const res = await fetch(url);
        if (!res.ok) throw new Error("KhÃ´ng táº£i Ä‘Æ°á»£c file");

        const blob = await res.blob();
        const a = document.createElement("a");

        a.href = URL.createObjectURL(blob);
        a.download = filename;

        document.body.appendChild(a);
        a.click();
        a.remove();

        URL.revokeObjectURL(a.href);
        statusEl.innerText = "âœ… Táº£i xong";
      } catch (err) {
        console.error(err);
        statusEl.innerText = "âŒ Lá»—i khi táº£i file";
      }
    }

    // ğŸ“¥ Láº¤Y DANH SÃCH FILE Tá»ª SERVER
    fetch("/api/files")
      .then(res => res.json())
      .then(files => {
        if (!files.length) {
          listEl.innerHTML = "<li>KhÃ´ng cÃ³ file nÃ o</li>";
          return;
        }

        files.forEach(f => {
          const li = document.createElement("li");
          li.innerHTML = `
            ${f.name}
            <button>â¬‡ Táº£i</button>
          `;

          li.querySelector("button").onclick = () => {
            downloadFile(f.url, f.name);
          };

          listEl.appendChild(li);
        });
      })
      .catch(err => {
        console.error(err);
        statusEl.innerText = "âŒ KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch file";
      });
  </script>

</body>
</html>
