<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Web há»c táº­p</title>
  <style>
    body { font-family: Arial; margin: 40px }
    input, button { margin: 5px }
    li { margin: 6px 0 }
  </style>
</head>
<body>

<h1>ğŸ“š TÃ€I LIá»†U Há»ŒC Táº¬P</h1>

<ul id="list"></ul>

<hr>

<h2>ğŸ” Admin Ä‘Äƒng nháº­p</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">ÄÄƒng nháº­p</button>

<h2>â¬†ï¸ Upload tÃ i liá»‡u (Admin)</h2>
<input id="title" placeholder="TÃªn tÃ i liá»‡u">
<input type="file" id="file">
<button onclick="upload()">Upload</button>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const API = ""; // cÃ¹ng domain Render
const supabase = supabaseJs.createClient(
  "SUPABASE_URL",
  "SUPABASE_ANON_KEY"
);

let token = null;

/* load danh sÃ¡ch tÃ i liá»‡u */
async function load() {
  const res = await fetch("/api/docs");
  const data = await res.json();
  list.innerHTML = data.map(
    d => `<li>
      <a href="${d.file_url}" download>${d.title}</a>
    </li>`
  ).join("");
}

/* Ä‘Äƒng nháº­p admin */
async function login() {
  const { data, error } = await supabase.auth.signInWithPassword({
    email: email.value,
    password: password.value
  });

  if (error) {
    alert("Sai tÃ i khoáº£n");
    return;
  }

  token = data.session.access_token;
  alert("ÄÄƒng nháº­p thÃ nh cÃ´ng");
}

/* upload tÃ i liá»‡u */
async function upload() {
  if (!token) {
    alert("ChÆ°a Ä‘Äƒng nháº­p admin");
    return;
  }

  const form = new FormData();
  form.append("title", title.value);
  form.append("file", file.files[0]);

  await fetch("/api/upload", {
    method: "POST",
    headers: {
      Authorization: "Bearer " + token
    },
    body: form
  });

  load();
}

load();
</script>

</body>
</html>
